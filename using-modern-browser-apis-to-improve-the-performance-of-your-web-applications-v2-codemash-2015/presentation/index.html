<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>Make it Fast: Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications</title>

        <meta name="description" content="Make it Fast: Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications">
        <meta name="author" content="Nic Jansma">

        <meta name="apple-mobile-web-app-capable" content="yes" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/nicj.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <h1>Make it Fast</h1>
                
                    <p>Using Modern Brower APIs to Monitor and Improve the Performance of your Web Applications</p>

                    <p style="margin-top: 40px">
                        <small><a href="http://nicj.net">nic jansma</a> |</small>
                        <small><a href="http://nicj.net">nicj.net</a> |</small>
                        <small><a href="http://twitter.com/nicj">@nicj</a></small>
                    </p>
                </section>
                
                <section>
                    <div style="float: right;    text-align: center">
                        <img src="images/nic.jpg" />
                    </div>
                
                    <h2>Who Am I?</h2>

                    <p>Nic Jansma</p>
                    <p><a href="mailto:nic@nicj.net">nic@nicj.net</a></p> 
                    <p><a href="https://twitter.com/nicj/">@nicj</a></p>
                    <p><a href="http://nicj.net">http://nicj.net</a></p>
                    <p><img src="images/soasta.png" /></p>

                    <ul>
                        <li>Senior Software Engineer @ SOASTA (current)</li>
                        <li>Senior Software Engineer @ Microsoft (2005-2011)</li>
                        <li>Founding member of W3C WebPerf Working Group</li>
                    </ul>
                </section>
                
                <section>
                    <section>
                        <h2>State of Performance Measurement</h2>
                        
                        <p>How do we measure performance?</p>
                    </section>
                
                    <section>
                        <h3>Server Performance</h3>
                        <ul>
                            <li>HTTP logs</li>
                            <li>Server monitoring (cacti, mrtg, nagios, new relic)</li>
                            <li>Profiling</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>Developer</h3>
                        <ul>
                            <li>Browser developer tools</li>
                            <li>Network monitoring (Fiddler, WireShark)</li>
                        </ul>
                    </section>
                    
                    <section>
                        <h3>Client-side / Real World</h3>
                        <ul>
                            <li><code>Date.now()</code> timing</li>
                            <li>Boomerang</li>
                        </ul>
                    </section>
                    
                    <section>
                        <p>Measuring performance from the server and developer perspective is not the full story</p>
    
                        <p>The only thing that really matters is what your end-user sees</p>
    
                        <p>Measuring real-world performance of your end-users is tough</p>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h2>W3C WebPerf Working Group</h2>
                        
                        <p><a href="http://www.w3.org/2010/webperf/">http://www.w3.org/2010/webperf/</a></p>
                        
                        <p>Founded in 2010 to give developers the ability to assess and understand performance characteristics of their applications</p>
                        
                        <quote>The mission of the Web Performance Working Group is to provide methods to measure aspects of application performance of user agent features and APIs</quote>
                        
                        <p>Collaborative effort from Microsoft, Google, Mozilla, Opera, Facebook, Netflix, etc</p>
                    </section>
                    
                    <section>
                        <h2>Working Group Goals</h2>
                    
                        <p>Expose information that was not previously available</p>
                        
                        <p>Give developers the tools they need to make their applications more efficient</p>
                        
                        <p>Little or no overhead</p>
                        
                        <p>Easy to understand APIs</p>
                    </section>
                    
                    <section>
                        <h2>Published Specs</h2>
                        
                        <ul>
                            <li><strong>Navigation Timing</strong> (NT): Page load timings</li>
                            <li><strong>Resource Timing</strong> (RT): Resource load times</li>
                            <li><strong>User Timing</strong> (UT): Custom site events and measurements</li>
                            <li><strong>Performance Timeline</strong>: Access NT/RT/UT and future timings from one interface</li>
                            <li><strong>Page Visibility</strong>: Visibility state of document</li>
                            <li><strong>Timing control for script-based animations</strong>: requestAnimationFrame</li>
                            <li><strong>High Resolution Time</strong>: Better Date.now()</li>
                            <li><strong>Efficient Script Yielding</strong>: More efficient than setTimeout(...,0) / setImmediate()</li>
                        </ul>
                    </section>
                        
                    <section>
                        <h2>Upcoming Specs</h2>
                        <ul>
                            <li>Beacon</li>
                            <li>Resource Hints</li>
                            <li>Frame Timing</li>
                            <li>Resource Priorities</li>
                            <li>Navigation Error Logging</li>
                        </ul>
                    </section>
                    
                    <!-- reason I mention this is to encourage you -- if you're interested in any of these
                    things, feel free to participate on the email group or Github issues -->
                </section>
                
                <section>
                    <section>
                        <h2>NavigationTiming</h2>
                        
                        <p><a href="http://www.w3.org/TR/navigation-timing/">http://www.w3.org/TR/navigation-timing/</a></p>
                        
                        <p><strong>Goal: </strong> Expose performance metrics describing your visitor's page load
                            experience</p>
                            
                    </section>
                </section>
<section>

NavigationTiming
     
    Page load and other network phase timings
    Great modern browser support
    caniuse
    Network flow image

    How it was done before:
    
        <html><head><script>
        var start = new Date().getTime();
        function onLoad {
            var pageLoadTime = (new Date().getTime()) - start;
        }
        body.addEventListener(“load”, onLoad, false);
        </script>...</html>
        
        That’s all you get: total page load time (kinda)
        Technically, you get the time from the start of processing of JS in your HEAD to the time the body’s onLoad event fires
        
        Says nothing of time spent before HEAD is parsed (DNS, TCP, HTTP request)
        
        Date.getTime() has problems (imprecise, not monotonically non-decreasing, user clock changes)
    How to Use
        DOM: window.performance.timing
        Phases of navigation
            Redirect (301/302s)
            DNS
            TCP
            SSL
            Request
            Response
            Processing (DOM events)
            Load
        JSON.stringify(window.performance);

ResourceTiming
    caniuse
    Compressed RT
    Intro
        http://www.w3.org/TR/resource-timing/ 
        
        Similar to NavigationTiming, but for all of the resources (images, scripts, css, media, etc) on your page
        
        Get most of the data you can see in Net panel in Firebug/etc
        
        Support:
        IE10 
        Chrome 25+ (prefixed)
    
    How it was done before:

        (it wasn’t)

        For dynamically inserted content, you could time how long it took from DOM insertion to the element’s onLoad event, but that’s not practical for all of your resources
        
        You can get this information from Firebug, but that’s not the end-user’s performance
    
    How to Use
        DOM: See PerformanceTimeline
        Each resource:
        URL
        Initiator type (SCRIPT/IMG/CSS/XHR)
        Timings:
        Redirect (301/302s)
        DNS
        TCP
        Request
        SSL
        Response
        Processing (DOM events)
        Load
    
    Gotchas
        Many attributes zero’d out if the resource is cross-domain (redirect, DNS, connect, TCP, SSL, request) UNLESS server sends Timing-Allow-Origin HTTP header
        
            Timing-Allow-Origin: [* | yourserver.com]
        
        This is to protect your privacy (attacker can’t load random URLs to see where you’ve been)
        
        Your own CDNs should send this HTTP header if you want timing data.  3rd-party CDNs/scripts (eg. Google Analytics) should add this too.
        
        Only first 150 resources will be captured unless setResourceTimingBufferSize() is called
            
        Souder's gotchas    
    
Interlude: PerformanceTimeline (PT)
    http://www.w3.org/TR/performance-timeline/

    Interface to access all of the performance metrics that the browser exposes (eg. Navigation Timing, Resource Timing, User Timing, etc)
    
    Support:
    IE10 
    Chrome 25+ (prefixed)
    
    Only way to access Resource Timing, User Timing, etc

    Gives you a timeline view of performance metrics as they occur

    Future interfaces (say, rendering events) can be added as long as they hook into the Performance Timeline interface
        
    performance.getEntries()
    All entries in one array
        performance.getEntriesByType(type)
        eg performance.getEntriesByType(“resource”)
        performance.getEntriesByName(name)
        eg performance.getEntriesByName(“http://myurl.com/foo.js”)
        
        interface PerformanceEntry {
           readonly attribute DOMString name;
           readonly attribute DOMString entryType;
           readonly attribute DOMHighResTimeStamp startTime;
           readonly attribute DOMHighResTimeStamp duration;
        }; 
    
    
UserTiming
    caniuse
    SO post?
    UserTiming.js
    
    http://www.w3.org/TR/user-timing/ 

    Custom site profiling and measurements
    
    Support:
    IE10 
    Chrome 25+ (prefixed)
        
    How it was done before:

    <script>
    var myMeasurements = [];
    var startMeasure = new Date().getTime();
    ...
    myMeasurements.push((new Date().getTime()) - start);
    </script>
    
    Problems: Date is imprecise, not monotonically non-decreasing, user clock changes
        
    Mark a timestamp:
    performance.mark(“foo_start”)
    performance.mark(“foo_end”)
    
    Log a measure (difference of two marks)
    performance.measure(“foo”, “foo_start”, “foo_end”)
    
    Get marks and measures
    performance.getEntriesByType(“mark”)
    [
     {name: “foo_start”, entryType: “mark”, startTime: 1000000.203, duration: 0}
     {name: “foo_end”, entryType: “mark”, startTime: 1000010.406, duration: 0}
    ]
    
    performance.getEntriesByType(“measure”)
    [
     {name: “foo_end”, entryType: “measure”, startTime: 1000000.203, duration: 10.203}
    ]
    
    Easy way to add profiling events to your application

    Uses DOMHighResolutionTimeStamp instead of Date.getTime() for higher precision
    
    Can be used along-side NT and RT timings to get a better understanding of your app’s performance in the real-world

Real World Usage
    Boomerang
    Google Analytics
    http://www.sitespeed.io/
    SOASTA
        mPulse
        Waterfalls
    New Relic
    https://github.com/andreas-marschke/boomerang-express
</section>

                <section>
                    <section>
                        <h2>Sails.js is:</h2>

                        <ul>
                            <li>A MVC backend web framework for Node.js</li>

                            <li>Built on top of Express</li>

                            <li>Inspired by Ruby on Rails / Symfony / Zend</li>

                            <li>Convention over configuration</li>

                            <li>Ideal for chat, realtime dashboards and multiplayer games</li>
                        </ul>
                    </section>

                    <section>
                        <h2>Sails.js core features</h2>

                        <ul>
                            <li>100% JavaScript</li>

                            <li>Database agnostic (includes custom ORM)</li>

                            <li>Auto-generated REST APIs</li>

                            <li>Easy WebSocket support and integration with REST</li>

                            <li>Reusable security policies</li>

                            <li>Front-end agnostic</li>

                            <li>Flexible asset pipeline (builds)</li>
                        </ul>
                    </section>

                </section>

                <section>
                    <section>
                        <h2>Getting Started</h2>

<pre><code data-trim class="javascript">
npm install -g sails
sails new [project path]
cd [project path]
</code></pre>
                    </section>

                    <section>
                        <h2>Running Your New Web App</h2>

<pre><code data-trim class="javascript">
sails lift
</code></pre>
                    </section>

                    <section>
<pre><code data-trim class="javascript">
info: Starting app...

info:
info:
info:    Sails              <|
info:    v0.10.2             |\
info:                       /|.\
info:                      / || \
info:                    ,'  |'  \
info:                 .-'.-==|/_--'
info:                 `--'-------'
info:    __---___--___---___--___---___--___
info:  ____---___--___---___--___---___--___-__
info:
info: Server lifted in `example1`
info: To see your app, visit http://localhost:1337
info: To shut down Sails, press &lt;CTRL&gt; + C at any time.

debug: --------------------------------------------------------
debug: :: Thu Aug 07 2014 06:43:55 GMT-0400 (Eastern Daylight Time)

debug: Environment : development
debug: Port        : 1337
debug: --------------------------------------------------------
</code></pre>
                    </section>

                     <section>
                        <h2>http://localhost:1337</h2>
                        <img src="images/first-launch.png" width="75%" height="75%"/>
                     </section>

                    <section>
                        <h2>Generate Model and REST API</h2>

                        <p>Let's create a new <code>beer</code> model and REST API</p>

<pre><code data-trim class="javascript">
sails generate api beer
</code></pre>
                        <p>This creates skeleton files: <code>api\controllers\BeerController.js</code> and
                            <code>api\model\Beer.js</code></p>
                    </section>

                    <section>
                        <h2>Try it out</h2>

                        <p><a href="http://localhost:1337/beer">http://localhost:1337/beer</a></p>

<pre><code data-trim class="javascript">
[]
</code></pre>
                        <p><a href="http://localhost:1337/beer/create?name=Centennial IPA&brewery=Founders">http://localhost:1337/beer/create?name=Centennial IPA&brewery=Founders&have=10</a></p>

<pre><code data-trim class="javascript">
{
    "name": "All Day IPA",
    "brewery": "Founders",
    "createdAt": "2014-08-07T13:11:10.536Z",
    "updatedAt": "2014-08-07T13:38:21.517Z",
    "id": 1,
    "have": 10
},
</code></pre>
                    </section>

                    <section>
                        <h2>Try it out</h2>

                        <p><a href="http://localhost:1337/beer">http://localhost:1337/beer</a></p>

<pre><code data-trim class="javascript">
[
    {
        "name": "All Day IPA",
        "brewery": "Founders",
        "createdAt": "2014-08-07T13:11:10.536Z",
        "updatedAt": "2014-08-07T13:38:21.517Z",
        "id": 1,
        "have": 10
    }
]
</code></pre>
                    </section>

                    <section>
                        <h2>What just happened</h2>

                        <ul>
                            <li>Sails created a Model (<code>Beer.js</code>) and Controller (<code>BeerController.js</code>)</li>

                            <li>Sails <i>blueprints</i> automatically configure new routes for the model (eg <code>POST /beer</code> and <code>/beer/create</code>).</li>

                            <li>Sails uses whatever storage layer you want for persistence</li>
                        </ul>
                    </section>

                </section>

                <section>
                    <section>
                        <h2>Anatomy of a Sails.js App</h2>

                        <ul>
                            <li><code>api/controller/</code> - controllers</li>
                            <li><code>api/models/</code> - models</li>
                            <li><code>api/policies/</code> - authentication / authorization</li>
                            <li><code>api/responses/</code> - <code>res.xyz()</code> handlers</li>
                            <li><code>api/services/</code> - services</li>
                            <li><code>assets/</code> - static assets</li>
                            <li><code>config/</code> - app config</li>
                            <li><code>tasks/</code> - grunt / cli tasks</li>
                            <li><code>views/</code> - views</li>
                        </ul>

                    </section>

                    <section>
                        <h2>Models</h2>

                        <ul>
                            <li><a href="http://sailsjs.org/#!documentation/models">http://sailsjs.org/#!documentation/models</a></li>

                            <li><code>api/models/*</code></li>

                            <li>Uses <a href="https://github.com/balderdashy/waterline">Waterline ORM</a> (best parts of Active Record, Hibernate and Mongoose)</li>
                        </ul>

<pre><code data-trim class="javascript">
module.exports = {
  attributes: {
    name: {
      type: 'string',
      required: true
    },
    brewery: {
      type: 'string',
      required: true
    },
    have: {
      type: 'integer',
      defaultTo: 1
    }
  }
};
</code></pre>
                    </section>

                    <section>
                        <h2>Controllers</h2>

                        <ul>
                            <li><a href="http://links.sailsjs.org/docs/controllers">http://links.sailsjs.org/docs/controllers</a></li>

                            <li><code>api/controllers/*</code></li>

                            <li>With Blueprints (<code>config/blueprints.js</code>), you automatically get CRUD REST and "shortcut" routes</li>
                        </ul>

                    </section>

                    <section>
                        <h2>Blueprint Routes</h2>

                        <p>By default, Sails creates three types of <i>blueprint</i> routes:</p>

                        <ul>
                            <li><b>RESTful routes</b> for <code>/:model</code> (HTTP <code>GET</code>, <code>DELETE</code>, etc)</li>

                            <li><b>Shortcut routes</b> to easily test your model via HTTP <code>GET</code> requests,
                                such as <code>/:model/delete/:id</code> (should be turned off in production)</li>

                            <li><b>Action routes</b> for any additional actions in your controllers</li>
                        </ul>

                        <p>Authentication and access control are handled via policies</p>

                    </section>

                    <section>
                        <h2>Blueprint Routes</h2>

                        <table>
                            <tr><th></th><th>REST</th><th>Shortcut</th></tr>
                            <tr><td>Query</td><td>GET /api/:model</td></tr>
                            <tr><td>Fetch</td><td>GET /api/:model/:id</td></tr>
                            <tr><td>Create</td><td>POST /api/:model</td><td>GET /api/:model/create</td></tr>
                            <tr><td>Update</td><td>PUT /api/:model/:id</td><td>GET /api/:model/update/:id</td></tr>
                            <tr><td>Delete</td><td>DELETE /api/:model/:id</td><td>GET /api/:model/destroy/:id</td></tr>
                        </table>

                    </section>

                    <section>
                        <h2>Blueprint Actions</h2>

                        <p>By default, Sails creates actions on your controllers for ORM functionality:</p>

                        <ul>
                            <li>find</li>
                            <li>findOne</li>
                            <li>create</li>
                            <li>update</li>
                            <li>destroy</li>
                            <li>populate</li>
                            <li>add</li>
                            <li>remove</li>
                        </ul>

                    </section>

                    <section>
                        <h2>Custom Actions and Routes</h2>
<pre><code data-trim class="javascript">
// config/routes.js
module.exports.routes = {
  '/': {
    view: 'homepage'
  },
  'post /beer/:id/drink': 'BeerController.drink'
}
</code></pre>
<pre><code data-trim class="javascript">
// BeerController.js
module.exports = {
  drink: function (req, res) {
    if (!req.params.id) { return res.badRequest('ID not supplied'); }

    Beer.findOne({ id: req.params.id }, function(err, model) {
      if (err || !model) {
        return res.badRequest('Beer not found');
      }

      model.have--;

      model.save(function(err) {
        return res.ok(model);
      });
    });
  }
};
</code></pre>
                    </section>

                    <section>
                        <h2>Views</h2>

                        <ul>
                            <li><a href="http://sailsjs.org/#!documentation/views">http://sailsjs.org/#!documentation/views</a></li>

                            <li><code>api/views/*</code></li>

                            <li>Uses EJS by default but can switch to Jade, etc</li>
                        </ul>

<pre><code data-trim class="javascript">
// BeerController.js
module.exports = {
  show: function(req, res) {
    Beer.find({}, function (err, beers) {
      res.view('show-beers', { title: 'Beers', beers: beers });
    });
  }
};
</code></pre>
<pre><code data-trim class="html">
// show-beers.ejs
&lt;ul&gt;
&lt;% for(var i=0; i&lt;beers.length; i++) {%&gt;
   &lt;li&gt;&lt;%= beers[i].name %&gt;&lt;/li&gt;
&lt;% } %&gt;
&lt;/ul&gt;
</code></pre>
                    </section>

                    <section>
                        <h2>Socket.IO integration</h2>

                        <p>Sails automatically translates incoming socket.io messages into Express requests</p>

                        <p>Also gives you Pub/Sub via <code>res.broadcast()</code> and <code>req.join()</code></p>

<pre><code data-trim class="javascript">
var socket = io.connect('http://localhost:1337');
socket.request('/beer', {}, function(beers) { console.log(neers); });
</code></pre>

                        <img src="images/socket-io.png" />
                    </section>

                </section>

                <section>
                    <h2>Links</h2>

                    <ul>
                        <li>Sails.js: <a href="http://sailsjs.org/">sailsjs.org</a></li>
                        <li>SailsCasts: <a href="http://irlnathan.github.io/sailscasts/">irlnathan.github.io/sailscasts/</a>

                        <li>Presentation: <a href="http://www.slideshare.net/nicjansma">slideshare.net/nicjansma</a></li>
                        <li>Code: <a href="https://github.com/nicjansma/talks/">github.com/nicjansma/talks/</a></li>
                    </ul>

                    <p style='margin-top: 20px'><small>Thanks - Nic Jansma - <a href="http://nicj.net">nicj.net</a> - <a href="https://twitter.com/NicJ">@NicJ</a></small></p>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
